# 암호화 알고리즘

## RSA
`RSA`는 `비대칭키`암호화 방식이며, `공개키` 암호 시스템이다.(표준으로 쓰이는 곳이 많다고 한다.)
`RSA`의 핵심은 큰 정수의 `소인수 분해`가 어렵다는 점이다.  
현재 `전자상거래`, `전자서명`에서 가장 흔하게 쓰이고 있는 알고리즘 중 하나이다.  
`SSL`프로토콜을 가진 많은 웹브라우저, `PGP`, 공개키 암호 시스템을 사용하는 정부 시스템 등에서 사용


### RSA 암호 알고리즘 방식
1. A가 B에게 RSA 알고리즘을 이용해 정보를 보낸다. 
2. B가 공개키와 개인키를 만들어 A에게 공개키를 보낸다. (이 때, 개인키는 B가 갖고있는다.)
3. A가 B로부터 받은 공개키를 이용하여 보낼 정보를 암호화한다. 
4. A가 암호화된 정보를 B에게 보낸다. 
5. B가 암호화된 정보를 받고 개인키를 이용하여 암호를 복호화한다.  

### RSA 원리

`공개키는 두 정수 n, e`로 만들어져있고, `개인키는 두 정수 n, d`로 만들어져있다.  

1. 개인키와 공개키 만들기
   - n 구하기
     - 임의의 `두 소수 p와 q`를 정하고, `n = p * q`를 통해 n 설정
   - e 구하기
     - *Ø(n) = (p-1) * (q-1)*을 이용해 Ø(n)과 `서로소인 e`를 구한다.  
     - `서로소`란, 1을 제와한 공약수를 갖지 않는 수를 뜻 함.
   - d 구하기
     - `*(e * d) mod Ø(n) = 1*를 이용한다.  
     - e * d 를 Ø(n)으로 나누었을 때 `a`인 d를 구한다.  
<br>
2. 암호화 하기
원래 정보를 M이라고 하고, 암호화된 정보를 C라고 하자.  
*C = M^e mod n*을 이용하여 M을 C로 암호화 한다.  
이 때, 암호화를 위해 `e`와 `n`의 값을 알아야 하므로, `공개키(n, e)`가 필요하다.
<br>
3. 복호화 하기
   1) *C = M^e mod n*
   2) *M = C^d mod n*
      - `페르미의 소정리`에 의해 1번식이 성립하면 2번 식도 성립한다.  
      - 복호화를 할 때는 2번 식을 사용한다.  
      - 이 때, `n`과 `d`의 값을 알아야 하므로, `개인키(n, d)`가 필요하다.
<br>
4. RSA의 안전성
공개키를 가지고 있는 사람 C가 있다고 가정하자.  
C는 공개키를 가지고 있으므로, 3번에서 `페르마의 소정리`에 의해 개인키도 알아낼 수 있다.  
결국 복호화에 성공할 수 있다는 의미인데, RSA의 장점 중 하나가 개인키를 알아낼 수 없다는 점이다.  
<br>
모슨이 되는 부분을 찾아보자.  
*n = p * q*라서 작은 숫자일 때는 p, q를 찾기 쉽다.  
하지만, n이 엄청 큰 수라면 p와 q 소수를 찾아내기 어렵다.  
결국 *(e * d) mod Ø(n) = 1*이 되는 식에서 e와 Ø(n)을 알고있으니 d를 구할 수 있다.  
하지만, d를 구하기에도 나머지가 1인 수가 너무 많아 개인키에 해당하는 d를 찾기란 매우 어렵다.

### RSA를 공격할 수 있는 경우
1. 수학적 공격(소인수 분해 공격)
    - 개인키 d의 비트 수가 크면 클수록 더 안전함
    - 하지만, 키의 길이가 길어지면 시스템 처리 속도는 저하
    - 위에서 본 것처럼 RSA를 공격하는데에 성공하는 것이 쉬운건 아니지만 사실 100% 안전은 아니라는 의미
2. 타이밍 공격(시간 공격)
    - 복호화 알고리즘의 실행 시간에 따라 달라짐
    - 다양한 방법을 통해 소요되는 시간이 드러나지 않게 막아 키 길이를 추측하는 공격 예방
      - 예) `랜덤 지체` 방법으로 타이밍 공격을 막을 수 있음
3. 선택 암호문 공격(CCA)과 OAEP
    - 선택-암호문 공격은 임의의 데이터를 송신했을 때, 그 것을 암호문으로 간주하고 회신해주는 서비스를 공격자가 이용하는 경우
    - 공격자가 임의로 만든 암호문을 서버에 여러 차례 보내고, 서버로부터 회신받은 오류 메시지나 타이밍 분석으로 키의 정보나 평문의 정보를 얻음
    - `최적 비대칭 암호화 패딩(OAEP)`이라는 프로시저를 사용해 평문을 수정할 것을 권장

#### OAEP
- `최적 비대칭키 암호 패딩`방식
- `RSA-OAEP`는 RSA를 개량한 알고리즘
- 복호화 과정에서 평문 해시값과 정해진 개수의 '0'등으로 만들어진 "인증정보"를 평문의 앞에 추가하고 RSA로 암호화함 -> 패딩
  - 올바른 인증정보가 나타나지 않으면 "평문을 알고있는 사람이 만든 암호문이 아니다"라고 판단
    - `decryption error`발생 & 오류 메시지 회신
  - 선택-암호문 공격 방식으로부터 안전해짐